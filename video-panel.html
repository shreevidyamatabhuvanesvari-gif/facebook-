<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Reel Video Generator</title>
<script src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.2/dist/ffmpeg.min.js"></script>

<style>
body{
  background:black;
  color:white;
  text-align:center;
  font-family:Arial;
}

input,button{
  margin:8px;
  padding:8px;
  border-radius:6px;
  border:none;
}

video{
  width:95%;
  max-width:400px;
  margin-top:15px;
}
</style>
</head>

<body>

<h2>üé¨ Reel Video Generator</h2>

<input type="file" id="videoInput" accept="video/*"><br>
<input type="text" id="captionText" placeholder="Caption ‡§≤‡§ø‡§ñ‡•á‡§Ç"><br>
<button onclick="generateVideo()">Generate Video</button>

<br>
<video id="preview" controls></video>

<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log: true });

let videoFile;

document.getElementById("videoInput").addEventListener("change", (e)=>{
  videoFile = e.target.files[0];
  document.getElementById("preview").src = URL.createObjectURL(videoFile);
});

async function generateVideo(){

  if(!videoFile){
    alert("Video upload ‡§ï‡§∞‡•á‡§Ç");
    return;
  }

  const caption = document.getElementById("captionText").value;
  if(!caption){
    alert("Caption ‡§≤‡§ø‡§ñ‡•á‡§Ç");
    return;
  }

  alert("Processing ‡§∂‡•Å‡§∞‡•Ç... ‡§•‡•ã‡§°‡§º‡§æ ‡§∏‡§Æ‡§Ø ‡§≤‡§ó‡•á‡§ó‡§æ ‚è≥");

  if(!ffmpeg.isLoaded()){
    await ffmpeg.load();
  }

  ffmpeg.FS("writeFile", "input.mp4", await fetchFile(videoFile));

  await ffmpeg.run(
    "-i", "input.mp4",
    "-vf",
    `drawtext=text='${caption}':fontcolor=yellow:fontsize=40:x=(w-text_w)/2:y=h-100`,
    "-codec:a", "copy",
    "output.mp4"
  );

  const data = ffmpeg.FS("readFile", "output.mp4");

  const url = URL.createObjectURL(
    new Blob([data.buffer], { type: "video/mp4" })
  );

  const a = document.createElement("a");
  a.href = url;
  a.download = "reel.mp4";
  a.click();

  alert("Video ‡§§‡•à‡§Ø‡§æ‡§∞ ‚úÖ");
}
</script>

</body>
</html>
