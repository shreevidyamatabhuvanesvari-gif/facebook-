<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Reel Generator</title>

<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>

<style>
body{
  background:black;
  color:white;
  text-align:center;
  font-family:Arial;
}

input,button{
  margin:10px;
  padding:8px;
  border-radius:6px;
  border:none;
}

video{
  width:95%;
  max-width:400px;
  margin-top:15px;
}
</style>
</head>

<body>

<h2>üé¨ Reel Video Generator</h2>

<input type="file" id="videoInput" accept="video/*"><br>
<input type="text" id="captionText" placeholder="Caption ‡§≤‡§ø‡§ñ‡•á‡§Ç"><br>
<button id="generateBtn">Generate Video</button>

<br>
<video id="preview" controls></video>

<script>
const { createFFmpeg, fetchFile } = FFmpeg;

const ffmpeg = createFFmpeg({
  log: true,
  corePath: "https://cdn.jsdelivr.net/npm/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js"
});

let videoFile;

document.getElementById("videoInput").addEventListener("change", (e)=>{
  videoFile = e.target.files[0];
  document.getElementById("preview").src = URL.createObjectURL(videoFile);
});

document.getElementById("generateBtn").addEventListener("click", async ()=>{

  if(!videoFile){
    alert("‡§™‡§π‡§≤‡•á video upload ‡§ï‡§∞‡•á‡§Ç");
    return;
  }

  const caption = document.getElementById("captionText").value;
  if(!caption){
    alert("Caption ‡§≤‡§ø‡§ñ‡•á‡§Ç");
    return;
  }

  try{

    alert("FFmpeg load ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à ‚è≥ (‡§™‡§π‡§≤‡•Ä ‡§¨‡§æ‡§∞ ‡§∏‡§Æ‡§Ø ‡§≤‡§ó‡•á‡§ó‡§æ)");

    if(!ffmpeg.isLoaded()){
      await ffmpeg.load();
    }

    ffmpeg.FS("writeFile", "input.mp4", await fetchFile(videoFile));

    await ffmpeg.run(
      "-i", "input.mp4",
      "-vf",
      `drawtext=text='${caption}':fontcolor=yellow:fontsize=40:x=(w-text_w)/2:y=h-80`,
      "-codec:a", "copy",
      "output.mp4"
    );

    const data = ffmpeg.FS("readFile", "output.mp4");

    const url = URL.createObjectURL(
      new Blob([data.buffer], { type: "video/mp4" })
    );

    const a = document.createElement("a");
    a.href = url;
    a.download = "reel.mp4";
    a.click();

    alert("Video ‡§§‡•à‡§Ø‡§æ‡§∞ ‚úÖ");

  }catch(err){
    console.error(err);
    alert("Error ‡§Ü‡§Ø‡§æ ‚Äî console check ‡§ï‡§∞‡•á‡§Ç");
  }

});
</script>

</body>
</html>
