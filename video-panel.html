<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video Line Caption</title>

<style>
body{
    margin:0;
    background:black;
    color:white;
    font-family:Arial, sans-serif;
    text-align:center;
    padding:15px;
}

h2{
    margin-bottom:10px;
}

input, textarea, button{
    width:90%;
    max-width:400px;
    margin-top:10px;
    padding:10px;
    font-size:16px;
    border-radius:8px;
    border:none;
}

button{
    background:#ff0055;
    color:white;
    font-weight:bold;
}

/* Video Container */
#videoContainer{
    position:relative;
    width:100%;
    margin-top:15px;
}

#videoPlayer{
    width:100%;
    max-height:65vh;
    border-radius:10px;
    background:black;
}

/* Caption Style */
#captionBox{
    position:absolute;
    bottom:25px;
    left:50%;
    transform:translateX(-50%);
    font-size:28px;
    font-weight:bold;
    text-align:center;
    width:90%;
    text-shadow:2px 2px 6px black;
    line-height:36px;
}

/* Line Animation */
.line{
    animation:fadeIn 0.3s ease;
}

@keyframes fadeIn{
    from{opacity:0; transform:translate(-50%,10px);}
    to{opacity:1; transform:translate(-50%,0);}
}
</style>
</head>

<body>

<h2>Video Line-by-Line Caption</h2>

<input type="file" id="videoInput" accept="video/*">

<textarea id="scriptInput" rows="5" placeholder="हर लाइन अलग लिखें..."></textarea>

<button id="prepareBtn">कैप्शन तैयार करें</button>
<button onclick="goFullScreen()">फुल स्क्रीन</button>
<button onclick="goBack()">वापस जाएँ</button>

<div id="videoContainer">
    <video id="videoPlayer" controls></video>
    <div id="captionBox"></div>
</div>

<script>
const videoInput = document.getElementById("videoInput");
const videoPlayer = document.getElementById("videoPlayer");
const scriptInput = document.getElementById("scriptInput");
const captionBox = document.getElementById("captionBox");
const prepareBtn = document.getElementById("prepareBtn");

let lines = [];
let videoDuration = 0;

// Random Color
function randomColor(){
    return "hsl(" + Math.floor(Math.random()*360) + ",100%,60%)";
}

// Upload Video
videoInput.addEventListener("change", function(){
    const file = this.files[0];
    if(file){
        videoPlayer.src = URL.createObjectURL(file);
        captionBox.innerHTML = "";
        scriptInput.value = "";
        lines = [];
    }
});

// Get Duration Safely
videoPlayer.addEventListener("loadedmetadata", function(){
    videoDuration = videoPlayer.duration;
});

// Prepare Captions
prepareBtn.addEventListener("click", function(){

    if(!videoPlayer.src){
        alert("पहले वीडियो चुनें");
        return;
    }

    if(!scriptInput.value.trim()){
        alert("पहले टेक्स्ट लिखें");
        return;
    }

    if(videoDuration === 0){
        alert("वीडियो अभी पूरी तरह लोड नहीं हुआ");
        return;
    }

    lines = scriptInput.value.trim().split("\n");
});

// Sync Lines
videoPlayer.addEventListener("timeupdate", function(){

    if(lines.length === 0) return;

    const currentTime = videoPlayer.currentTime;
    const interval = videoDuration / lines.length;
    const activeIndex = Math.floor(currentTime / interval);

    if(activeIndex >= 0 && activeIndex < lines.length){

        const words = lines[activeIndex].split(" ");
        captionBox.innerHTML = "";

        words.forEach(word=>{
            const span = document.createElement("span");
            span.textContent = word + " ";
            span.style.color = randomColor();
            captionBox.appendChild(span);
        });

        captionBox.className = "line";
    }

});

// Fullscreen Container
function goFullScreen(){
    const container = document.getElementById("videoContainer");

    if(container.requestFullscreen){
        container.requestFullscreen();
    } else if(container.webkitRequestFullscreen){
        container.webkitRequestFullscreen();
    } else if(container.msRequestFullscreen){
        container.msRequestFullscreen();
    }
}

// Back Button
function goBack(){
    window.location.href = "index.html";
}
</script>

</body>
</html>
